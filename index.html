<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROD-HUB PRO | Cinematic Management</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #ffb400;
            --accent-glow: rgba(255, 180, 0, 0.3);
            --bg: #050505;
            --surface: #121212;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text: #ffffff;
            --text-dim: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; overflow-x: hidden; }
        .hidden { display: none !important; }

        /* CUSTOM NOTIFICATIONS */
        #custom-alert {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: var(--surface); border: 1px solid var(--accent); padding: 15px 30px;
            border-radius: 12px; z-index: 10000; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); display: flex; align-items: center; gap: 12px;
        }
        #custom-alert.show { transform: translateX(-50%) translateY(0); }

        /* HEADER & ONLINE COUNTER */
        nav { 
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); padding: 1rem 2rem; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000;
        }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .nav-logo img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--accent); }
        
        .online-badge {
            background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success);
            padding: 5px 12px; border-radius: 20px; font-size: 0.65rem; color: var(--success);
            font-weight: 800; display: flex; align-items: center; gap: 6px; text-transform: uppercase;
        }
        .pulse-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: pulse 2s infinite; }

        /* MAIN CONTENT LAYOUT */
        .app-container { max-width: 900px; margin: 20px auto; padding: 0 15px; }

        /* HUB SECTIONS (TABS) */
        .section-content { display: none; animation: fadeIn 0.4s ease; }
        .section-content.active { display: block; }

        /* CARDS & PITCHES */
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 25px; margin-bottom: 20px; }
        .pitch-row { 
            background: var(--glass); border: 1px solid var(--border); border-radius: 16px; 
            padding: 20px; margin-bottom: 15px; transition: 0.3s; position: relative;
        }
        .pitch-row:hover { border-color: var(--accent); background: rgba(255,180,0,0.02); }
        .priority-high { border-left: 4px solid var(--danger); }

        /* TASK BUTTONS */
        .task-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .task-btn { 
            background: #000; border: 1px solid #222; padding: 12px; border-radius: 10px;
            font-size: 0.6rem; color: #555; text-align: center; font-weight: 800;
        }
        .task-btn.done { border-color: var(--success); color: var(--success); }
        .task-btn.ongoing { border-color: var(--accent); color: var(--accent); }

        /* FIXED BOTTOM TAB NAVIGATION */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(20px);
            padding: 8px; border-radius: 20px; border: 1px solid var(--border);
            display: flex; gap: 5px; z-index: 5000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .tab-trigger {
            padding: 12px 20px; border-radius: 15px; border: none; background: transparent;
            color: var(--text-dim); font-size: 0.7rem; font-weight: 800; cursor: pointer;
            display: flex; align-items: center; gap: 8px; transition: 0.3s; text-transform: uppercase;
        }
        .tab-trigger.active { background: var(--accent); color: #000; }

        /* INPUTS & BUTTONS */
        input, select, textarea {
            width: 100%; background: #000; border: 1px solid var(--border); color: #fff;
            padding: 15px; border-radius: 12px; margin-bottom: 10px; font-size: 0.9rem;
        }
        input:focus { border-color: var(--accent); outline: none; }
        .btn-primary { 
            background: var(--accent); color: #000; border: none; padding: 15px; 
            border-radius: 12px; font-weight: 800; cursor: pointer; width: 100%;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* UTILITY */
        .status-badge { font-size: 0.55rem; padding: 4px 10px; border-radius: 6px; font-weight: 900; }
        .tag-urgent { background: var(--danger); color: white; }
    </style>
</head>
<body>

    <div id="custom-alert">
        <i data-lucide="info" style="color:var(--accent)"></i>
        <span id="alert-text">Message here</span>
    </div>

    <div id="auth-section" style="height:100vh; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width: 350px; text-align: center;">
            <img src="https://i.imgur.com/7d3ROpd.jpeg" style="width:70px; border-radius:50%; border:2px solid var(--accent); margin-bottom:15px;">
            <h2 style="margin:0; letter-spacing:2px;">PROD-HUB</h2>
            <p style="color:var(--text-dim); font-size:0.7rem; margin-bottom:20px;">AUTHENTICATED ACCESS ONLY</p>
            <select id="user-role">
                <option value="Producer">Producer</option>
                <option value="Associate Producer">Associate Producer</option>
                <option value="Host">Program Host</option>
                <option value="Editor">Video Editor</option>
                <option value="Writer">Script Writer</option>
                <option value="Camera">Camera/DP</option>
            </select>
            <button class="btn-primary" onclick="handleGoogleAuth()">SIGN IN WITH GOOGLE</button>
        </div>
    </div>

    <div id="dashboard-section" class="hidden">
        <nav>
            <div class="nav-left">
                <div class="nav-logo"><img src="https://i.imgur.com/7d3ROpd.jpeg"></div>
                <div class="online-badge"><div class="pulse-dot"></div> <span id="user-count">8 ONLINE</span></div>
            </div>
            <div style="text-align: right; display: flex; align-items: center; gap: 15px;">
                <div>
                    <span id="user-display" style="font-weight: 800; font-size: 0.8rem; display: block;">NAME</span>
                    <span id="role-tag" style="font-size: 0.6rem; color: var(--accent); font-weight: 700;">ROLE</span>
                </div>
                <button onclick="handleLogout()" style="background:transparent; border:1px solid #333; color:#555; padding:5px 10px; border-radius:8px; font-size:0.6rem;">EXIT</button>
            </div>
        </nav>

        <div class="app-container">
            <div id="sec-hub" class="section-content active">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="margin:0; font-size:1.2rem; letter-spacing:1px;">PRODUCTION FEED</h3>
                    <div id="clock" style="color:var(--accent); font-weight:800; font-size:0.8rem;"></div>
                </div>
                
                <div class="hub-tabs" style="margin-bottom:20px;">
                    <button class="hub-tab active" id="tab-approval" onclick="switchHubTab('approval')">WAITING APPROVAL</button>
                    <button class="hub-tab" id="tab-production" onclick="switchHubTab('production')">PRODUCTION</button>
                    <button class="hub-tab" id="tab-airing" onclick="switchHubTab('airing')">ARCHIVE</button>
                </div>

                <input type="text" id="feedSearch" placeholder="Filter projects..." onkeyup="filterFeed()" style="background:var(--surface); margin-bottom:20px;">
                <div id="pitch-list">Loading feed...</div>
            </div>

            <div id="sec-create" class="section-content">
                <div class="card">
                    <h3 style="margin-top:0;"><i data-lucide="plus" class="icon-sm"></i> NEW PRODUCTION PITCH</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <select id="pPriority"><option value="Normal">Normal Priority</option><option value="Urgent">Urgent</option></select>
                        <input type="date" id="pDate">
                    </div>
                    <input type="text" id="pLoc" placeholder="Shoot Location">
                    <input type="text" id="pCam" placeholder="Camera/DP Email">
                    <input type="text" id="pEditor" placeholder="Editor Email">
                    <input type="url" id="pMedia" placeholder="Reference Link (URL)">
                    <textarea id="pAbout" rows="5" placeholder="Story concept..."></textarea>
                    <button class="btn-primary" onclick="addPitch()">SUBMIT TO HUB</button>
                </div>
            </div>

            <div id="sec-alerts" class="section-content">
                <div class="card">
                    <h3><i data-lucide="megaphone" class="icon-sm"></i> CREW ANNOUNCEMENTS</h3>
                    <div id="announcement-board" style="max-height:300px; overflow-y:auto; margin-bottom:20px;"></div>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="newAnnouncement" placeholder="Write message..." style="margin:0;">
                        <button onclick="postAnnouncement()" style="width:60px; background:var(--accent); border:none; border-radius:12px;"><i data-lucide="send"></i></button>
                    </div>
                </div>
            </div>

            <div id="sec-tasks" class="section-content">
                <div class="card">
                    <h3><i data-lucide="check-square" class="icon-sm"></i> MY PERSONAL WORKFLOW</h3>
                    <div id="task-list"></div>
                    <div style="display:flex; gap:10px; margin-top:20px;">
                        <input type="text" id="newTask" placeholder="Add custom task..." style="margin:0;">
                        <button onclick="addTask()" style="width:60px; background:var(--accent); border:none; border-radius:12px;"><i data-lucide="plus"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="tab-trigger active" onclick="showSection('sec-hub', this)"><i data-lucide="layers"></i> HUB</button>
            <button class="tab-trigger" onclick="showSection('sec-create', this)"><i data-lucide="plus-circle"></i> PITCH</button>
            <button class="tab-trigger" onclick="showSection('sec-alerts', this)"><i data-lucide="bell"></i> ALERTS</button>
            <button class="tab-trigger" onclick="showSection('sec-tasks', this)"><i data-lucide="check-square"></i> TASKS</button>
        </div>
    </div>

    <script>
        // CONFIG & INIT (LAHAT NG LOGIC MO PINANATILI)
        const firebaseConfig = {
            apiKey: "AIzaSyCWyMPS1vabyK_uGAWzmmeW9iuL7ksEUBE",
            authDomain: "prod-hub-d43c4.firebaseapp.com",
            projectId: "prod-hub-d43c4",
            storageBucket: "prod-hub-d43c4.firebasestorage.app",
            messagingSenderId: "262638128725",
            appId: "1:262638128725:web:12136df5187f89deff8edc"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const provider = new firebase.auth.GoogleAuthProvider();

        let currentHubTab = 'approval';
        let currentUserRole = '';

        // UI NAVIGATION
        function showSection(secId, btn) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-trigger').forEach(b => b.classList.remove('active'));
            document.getElementById(secId).classList.add('active');
            btn.classList.add('active');
            window.scrollTo(0,0);
        }

        function switchHubTab(tab) {
            currentHubTab = tab;
            document.querySelectorAll('.hub-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            loadGlobalPitches();
        }

        function showAlert(msg) {
            const el = document.getElementById('custom-alert');
            document.getElementById('alert-text').innerText = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // FIREBASE CORE (Mula sa file mo)
        auth.onAuthStateChanged(async user => {
            if (user) {
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('dashboard-section').classList.remove('hidden');
                const userDoc = await db.collection("users").doc(user.uid).get();
                if(userDoc.exists) {
                    const ud = userDoc.data();
                    currentUserRole = ud.role;
                    document.getElementById('role-tag').innerText = currentUserRole;
                    document.getElementById('user-display').innerText = ud.displayName || user.displayName;
                }
                loadGlobalPitches();
                loadPersonalTasks(user.uid);
                loadAnnouncements();
                lucide.createIcons();
            } else {
                document.getElementById('auth-section').classList.remove('hidden');
                document.getElementById('dashboard-section').classList.add('hidden');
            }
        });

        async function handleGoogleAuth() {
            const role = document.getElementById('user-role').value;
            try {
                const res = await auth.signInWithPopup(provider);
                const u = res.user;
                const doc = await db.collection("users").doc(u.uid).get();
                if (!doc.exists) {
                    await db.collection("users").doc(u.uid).set({
                        role: role, email: u.email, displayName: u.displayName || u.email.split('@')[0]
                    });
                }
            } catch(e) { showAlert("Auth Error: " + e.message); }
        }

        function handleLogout() { auth.signOut(); }

        // PITCH FEED
        function loadGlobalPitches() {
            db.collection("pitches").orderBy("createdAt", "desc").onSnapshot(snap => {
                const list = document.getElementById('pitch-list');
                const filtered = snap.docs.filter(doc => {
                    const p = doc.data();
                    const isDone = p.tasks?.script === 'done' && p.tasks?.shoot === 'done' && p.tasks?.edit === 'done' && p.tasks?.vo === 'done';
                    if (currentHubTab === 'approval') return !p.approved;
                    if (currentHubTab === 'production') return p.approved && !isDone;
                    if (currentHubTab === 'airing') return p.approved && isDone;
                });

                list.innerHTML = filtered.length ? filtered.map(doc => {
                    const p = doc.data();
                    const isOwner = auth.currentUser.email === p.author;
                    const canApprove = ['Producer', 'Associate Producer', 'Host'].includes(currentUserRole);
                    
                    return `
                    <div class="pitch-row ${p.priority === 'Urgent' ? 'priority-high' : ''}">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span class="status-badge ${p.priority === 'Urgent' ? 'tag-urgent' : ''}">${p.priority}</span>
                            <span style="font-size:0.7rem; color:var(--accent); font-weight:800;">${p.date || 'TBD'}</span>
                        </div>
                        <div style="font-size:0.75rem; color:#888; margin-bottom:10px;">
                            <b>LOC:</b> ${p.location} | <b>EDITOR:</b> ${p.editor || 'Unassigned'}
                        </div>
                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:10px; font-size:0.85rem; line-height:1.5; border:1px solid #222;">
                            ${p.about}
                        </div>
                        
                        ${p.approved ? `
                        <div class="task-grid">
                            <div class="task-btn ${p.tasks?.script}">SCRIPT
                                <select onchange="handleTaskDropdown('${doc.id}', 'script', this.value, ${isOwner})">
                                    <option value="">--</option><option value="ongoing">Work</option><option value="done">Done</option>
                                </select>
                            </div>
                            <div class="task-btn ${p.tasks?.shoot}">SHOOT
                                <select onchange="handleTaskDropdown('${doc.id}', 'shoot', this.value, true)">
                                    <option value="">--</option><option value="ongoing">Work</option><option value="done">Done</option>
                                </select>
                            </div>
                            <div class="task-btn ${p.tasks?.edit}">EDIT
                                <select onchange="handleTaskDropdown('${doc.id}', 'edit', this.value, true)">
                                    <option value="">--</option><option value="ongoing">Work</option><option value="done">Done</option>
                                </select>
                            </div>
                            <div class="task-btn ${p.tasks?.vo}">VO
                                <select onchange="handleVOActionDropdown('${doc.id}', this.value, true)">
                                    <option value="">--</option><option value="ongoing">Work</option><option value="done">Done</option>
                                </select>
                            </div>
                        </div>` : ''}

                        <div style="margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.6rem; color:#444;">BY: ${p.author}</span>
                            <div>
                                ${!p.approved && canApprove ? `<button onclick="approvePitch('${doc.id}')" style="background:var(--success); color:white; border:none; padding:5px 10px; border-radius:5px; font-size:0.6rem; font-weight:800;">APPROVE</button>` : ''}
                                ${isOwner ? `<button onclick="deletePitch('${doc.id}')" style="background:transparent; color:var(--danger); border:1px solid var(--danger); padding:5px 10px; border-radius:5px; font-size:0.6rem; margin-left:5px;">DELETE</button>` : ''}
                            </div>
                        </div>
                    </div>`;
                }).join('') : '<p style="text-align:center; color:#444; font-size:0.8rem; padding:40px;">No records found.</p>';
            });
        }

        // Logic functions unchanged from your original index.html
        async function handleTaskDropdown(id, type, val, permit) {
            if(!permit) return showAlert("Unauthorized Access");
            const obj = {}; obj[`tasks.${type}`] = val;
            await db.collection("pitches").doc(id).update(obj);
            showAlert("Tracker Updated");
        }

        async function handleVOActionDropdown(id, val, permit) {
            if(!permit) return showAlert("Access Denied");
            await db.collection("pitches").doc(id).update({"tasks.vo": val});
            showAlert("VO Status Updated");
        }

        async function approvePitch(id) {
            if(confirm("Approve this pitch?")) {
                await db.collection("pitches").doc(id).update({approved: true});
                showAlert("Pitch Approved!");
            }
        }

        async function addPitch() {
            const about = document.getElementById('pAbout').value;
            if(!about) return showAlert("Details required");
            await db.collection("pitches").add({
                priority: document.getElementById('pPriority').value,
                date: document.getElementById('pDate').value,
                location: document.getElementById('pLoc').value,
                cameraman: document.getElementById('pCam').value,
                editor: document.getElementById('pEditor').value,
                mediaLink: document.getElementById('pMedia').value,
                about: about, author: auth.currentUser.email,
                approved: false, createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                tasks: { script: "", shoot: "", edit: "", vo: "" }
            });
            showAlert("Pitch Posted!");
            showSection('sec-hub', document.querySelector('.tab-trigger'));
        }

        async function deletePitch(id) {
            if(confirm("Confirm Delete?")) { await db.collection("pitches").doc(id).delete(); showAlert("Removed."); }
        }

        function loadAnnouncements() {
            db.collection("announcements").orderBy("createdAt", "desc").limit(10).onSnapshot(snap => {
                document.getElementById('announcement-board').innerHTML = snap.docs.map(doc => `
                    <div style="border-bottom:1px solid #1a1a1a; padding:10px 0;">
                        <span style="color:var(--accent); font-size:0.6rem; font-weight:800;">${doc.data().author}</span>
                        <p style="margin:5px 0; font-size:0.8rem;">${doc.data().text}</p>
                    </div>
                `).join('');
            });
        }

        async function postAnnouncement() {
            const txt = document.getElementById('newAnnouncement').value;
            if(!txt) return;
            await db.collection("announcements").add({
                text: txt, author: auth.currentUser.displayName || auth.currentUser.email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            document.getElementById('newAnnouncement').value = '';
        }

        function loadPersonalTasks(uid) {
            db.collection("tasks").where("uid", "==", uid).onSnapshot(snap => {
                document.getElementById('task-list').innerHTML = snap.docs.map(doc => `
                    <div style="display:flex; justify-content:space-between; background:#000; padding:12px; border-radius:10px; margin-bottom:8px; border:1px solid #1a1a1a;">
                        <span style="font-size:0.8rem; ${doc.data().done ? 'text-decoration:line-through; opacity:0.3' : ''}">${doc.data().text}</span>
                        <input type="checkbox" ${doc.data().done ? 'checked' : ''} onchange="toggleTask('${doc.id}', ${doc.data().done})" style="width:auto; margin:0;">
                    </div>
                `).join('');
            });
        }

        async function addTask() {
            const val = document.getElementById('newTask').value;
            if(!val) return;
            await db.collection("tasks").add({ uid: auth.currentUser.uid, text: val, done: false, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            document.getElementById('newTask').value = '';
        }

        async function toggleTask(id, stat) { await db.collection("tasks").doc(id).update({done: !stat}); }

        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
            // Simulate dynamic online counter
            document.getElementById('user-count').innerText = (Math.floor(Math.random() * 3) + 7) + " ONLINE";
        }, 1000);

        function filterFeed() {
            const q = document.getElementById('feedSearch').value.toLowerCase();
            document.querySelectorAll('.pitch-row').forEach(r => r.style.display = r.innerText.toLowerCase().includes(q) ? 'block' : 'none');
        }
    </script>
</body>
</html>
